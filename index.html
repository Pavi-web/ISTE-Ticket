<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Registration</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Courier New", monospace;
        overflow-x: hidden;
        background: #000;
        color: #fff;
      }

      /* Main Split Container */
      .main-container {
        height: 100vh;
        display: flex;
        position: relative;
      }

      .left-section {
        width: 50%;
        background: linear-gradient(135deg, #0066ff, #0099ff);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .right-section {
        width: 50%;
        background: linear-gradient(135deg, #ff3366, #ff6699);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      /* Cyberpunk Effects */
      .left-section::before,
      .right-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(255, 255, 255, 0.03) 2px,
          rgba(255, 255, 255, 0.03) 4px
        );
        pointer-events: none;
      }

      .section-title {
        font-size: 4rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 8px;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        margin-bottom: 1rem;
        transform: skewX(-10deg);
      }

      .section-subtitle {
        font-size: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 4px;
        opacity: 0.8;
        transform: skewX(-10deg);
      }

      .date-info {
        position: absolute;
        bottom: 50px;
        font-size: 1.2rem;
        letter-spacing: 2px;
        opacity: 0.7;
      }

      /* Central Register Button */
      .register-btn-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
      }

      .register-btn {
        background: linear-gradient(45deg, #ff3366, #0066ff);
        border: none;
        padding: 20px 40px;
        font-size: 1.5rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 3px;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        box-shadow: 0 0 30px rgba(255, 51, 102, 0.5),
          inset 0 0 30px rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .register-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .register-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 50px rgba(255, 51, 102, 0.8),
          inset 0 0 30px rgba(255, 255, 255, 0.2);
      }

      .register-btn:hover::before {
        left: 100%;
      }

      /* Registration Form Styles */
      .registration-page {
        display: none;
        min-height: 100vh;
        background: linear-gradient(135deg, #000 0%, #1a1a2e 50%, #16213e 100%);
        padding: 2rem;
        position: relative;
      }

      .registration-page::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 100px,
          rgba(255, 51, 102, 0.03) 100px,
          rgba(255, 51, 102, 0.03) 102px
        );
        pointer-events: none;
      }

      .form-container {
        max-width: 600px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.05);
        padding: 3rem;
        border-radius: 10px;
        border: 1px solid rgba(255, 51, 102, 0.3);
        box-shadow: 0 0 50px rgba(255, 51, 102, 0.2);
        backdrop-filter: blur(10px);
      }

      .form-title {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 2rem;
        color: #ff3366;
        text-transform: uppercase;
        letter-spacing: 3px;
        text-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #0099ff;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid rgba(255, 51, 102, 0.3);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border-radius: 5px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #ff3366;
        box-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
      }

      .membership-section {
        background: rgba(0, 102, 255, 0.1);
        padding: 1.5rem;
        border-radius: 5px;
        border: 1px solid rgba(0, 102, 255, 0.3);
        margin: 1rem 0;
      }

      .payment-section {
        display: none;
        background: rgba(255, 51, 102, 0.1);
        padding: 1.5rem;
        border-radius: 5px;
        border: 1px solid rgba(255, 51, 102, 0.3);
        margin: 1rem 0;
      }

      .instructions {
        font-size: 0.9rem;
        color: #fff;
        margin-bottom: 1rem;
        opacity: 0.8;
        line-height: 1.5;
      }

      .submit-btn {
        width: 100%;
        padding: 20px;
        background: linear-gradient(45deg, #ff3366, #0066ff);
        border: none;
        color: white;
        font-size: 1.2rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 2rem;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(255, 51, 102, 0.5);
      }

      .back-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
      }

      .success-message {
        display: none;
        text-align: center;
        padding: 2rem;
        background: rgba(0, 255, 0, 0.1);
        border: 2px solid rgba(0, 255, 0, 0.3);
        border-radius: 10px;
        margin-top: 2rem;
        color: #00ff00;
      }

      /* Ticket Styles */
      .ticket-container {
        display: none;
        background: rgba(0, 0, 0, 0.9);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
      }

      .ticket {
        background: linear-gradient(135deg, #0066ff 0%, #000 50%, #ff3366 100%);
        width: 600px;
        height: 400px;
        border-radius: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 0 50px rgba(255, 51, 102, 0.5),
          inset 0 0 50px rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      .ticket::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 20px,
          rgba(255, 255, 255, 0.05) 20px,
          rgba(255, 255, 255, 0.05) 22px
        );
        pointer-events: none;
      }

      .ticket-header {
        text-align: center;
        padding: 30px 20px 20px;
        border-bottom: 2px dashed rgba(255, 255, 255, 0.3);
      }

      .ticket-title {
        font-size: 2rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 4px;
        color: #fff;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        margin-bottom: 10px;
      }

      .ticket-event {
        font-size: 1.2rem;
        color: #ff3366;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
      }

      .ticket-content {
        padding: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .ticket-left {
        flex: 1;
      }

      .ticket-right {
        flex: 1;
        text-align: right;
      }

      .ticket-field {
        margin-bottom: 15px;
      }

      .ticket-label {
        font-size: 0.9rem;
        color: #0099ff;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
      }

      .ticket-value {
        font-size: 1.1rem;
        color: #fff;
        font-weight: bold;
        margin-top: 5px;
      }

      .ticket-qr {
        width: 80px;
        height: 80px;
        background: linear-gradient(45deg, #ff3366, #0066ff);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.8rem;
        text-align: center;
        margin-bottom: 10px;
      }

      .ticket-id {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.7);
        font-family: "Courier New", monospace;
      }

      .ticket-actions {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
      }

      .ticket-btn {
        padding: 10px 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .ticket-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
      }

      .download-btn {
        border-color: rgba(0, 255, 0, 0.5);
        color: #00ff00;
      }

      .download-btn:hover {
        background: rgba(0, 255, 0, 0.1);
        border-color: #00ff00;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .main-container {
          flex-direction: column;
        }

        .left-section,
        .right-section {
          width: 100%;
          height: 50vh;
        }

        .section-title {
          font-size: 2.5rem;
          letter-spacing: 4px;
        }

        .register-btn {
          font-size: 1.2rem;
          padding: 15px 30px;
        }

        .ticket {
          width: 90%;
          height: 350px;
        }

        .ticket-content {
          padding: 20px;
          flex-direction: column;
          gap: 20px;
        }

        .ticket-right {
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Main Landing Page -->
    <div class="main-container" id="mainPage">
      <!-- Left Section - Public Speaking -->
      <div class="left-section">
        <h1 class="section-title">Public</h1>
        <h2 class="section-subtitle">Speaking</h2>
        <div class="date-info">13 TH SEPT</div>
      </div>

      <!-- Right Section - Python Basics -->
      <div class="right-section">
        <h1 class="section-title">Python</h1>
        <h2 class="section-subtitle">Basics</h2>
      </div>

      <!-- Central Register Button -->
      <div class="register-btn-container">
        <button class="register-btn" onclick="showRegistration()">
          Register
        </button>
      </div>
    </div>

    <!-- Registration Page -->
    <div class="registration-page" id="registrationPage">
      <button class="back-btn" onclick="showMainPage()">← Back to Main</button>

      <div class="form-container">
        <h2 class="form-title">Event Registration</h2>

        <form id="registrationForm">
          <div class="form-group">
            <label for="name">Full Name *</label>
            <input type="text" id="name" name="name" required />
          </div>

          <div class="form-group">
            <label for="email">Email Address *</label>
            <input type="email" id="email" name="email" required />
          </div>

          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input type="tel" id="phone" name="phone" required />
          </div>

          <div class="membership-section">
            <div class="form-group">
              <label for="isteMembership">Do you have ISTE Membership? *</label>
              <select
                id="isteMembership"
                name="isteMembership"
                required
                onchange="toggleMembershipFields()"
              >
                <option value="">Select an option</option>
                <option value="yes">Yes, I have ISTE Membership</option>
                <option value="no">No, I don't have ISTE Membership</option>
              </select>
            </div>

            <div
              class="form-group"
              id="membershipIdField"
              style="display: none"
            >
              <label for="membershipId">ISTE Membership ID *</label>
              <input type="text" id="membershipId" name="membershipId" />
            </div>
          </div>

          <div class="payment-section" id="paymentSection">
            <h3 style="color: #ff3366; margin-bottom: 1rem">
              Payment Required
            </h3>
            <p style="margin-bottom: 1rem; opacity: 0.8">
              Since you do not have an ISTE membership, a payment is required to
              complete your registration.
            </p>
            <div class="instructions">
              <strong>Instructions:</strong><br />
              1. Upload your payment receipt image to Google Drive.<br />
              2. Set the file access to "Anyone with the link" (public
              access).<br />
              3. Copy the shareable link and paste it in the field below.
            </div>
            <div class="form-group">
              <label for="paymentLink"
                >Payment Receipt Google Drive Link *</label
              >
              <input
                type="url"
                id="paymentLink"
                name="paymentLink"
                placeholder="Paste your public Google Drive link here"
                required
              />
            </div>
          </div>

          <button type="submit" class="submit-btn">
            Complete Registration
          </button>
        </form>

        <div class="success-message" id="successMessage">
          <h3>🎉 Registration Submitted!</h3>
          <p>
            Your registration has been submitted. You will receive your ticket
            via email once approved.
          </p>
        </div>
      </div>
    </div>

    <!-- Ticket Modal (kept for client-side preview if needed, but ticket is now sent via email) -->
    <div class="ticket-container" id="ticketContainer">
      <div class="ticket" id="eventTicket">
        <div class="ticket-header">
          <div class="ticket-title">Event Ticket</div>
          <div class="ticket-event">Public Speaking & Python Basics</div>
        </div>
        <div class="ticket-content">
          <div class="ticket-left">
            <div class="ticket-field">
              <div class="ticket-label">Participant</div>
              <div class="ticket-value" id="ticketName">-</div>
            </div>
            <div class="ticket-field">
              <div class="ticket-label">Email</div>
              <div class="ticket-value" id="ticketEmail">-</div>
            </div>
            <div class="ticket-field">
              <div class="ticket-label">ISTE Member</div>
              <div class="ticket-value" id="ticketMembership">-</div>
            </div>
            <div class="ticket-field">
              <div class="ticket-label">Event Date</div>
              <div class="ticket-value">13th September 2025</div>
            </div>
          </div>
          <div class="ticket-right">
            <div class="ticket-qr">VERIFIED<br />ISTE<br />MEMBER</div>
            <div class="ticket-id" id="ticketId">ID: -</div>
          </div>
        </div>
      </div>
      <div class="ticket-actions">
        <button class="ticket-btn download-btn" onclick="downloadTicket()">
          Download Ticket
        </button>
        <button class="ticket-btn" onclick="closeTicket()">Close</button>
      </div>
    </div>

    <script>
      // Replace with your Apps Script Web App URL
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbz8A-ErPCXGEiur34PXL_Ya7fxUJAhT0o0cQ9HEhJoemXc22YqzJqjwsT5Ez7zLJUK1/exec"; // Paste your web app URL here

      // Authorized ISTE member emails (kept for client-side logic if needed)
      const authorizedEmails = [
        "elbaannababu@gmail.com",
        "aseem7604@gmail.com",
        "aswaladarsh1@gmail.com",
        "asmiyahassain123@gmail.com",
        "Karthikeyanashari5@gmail.com",
        "Vijaysanil718@gmail.com",
        "fathimaluluh2004@gmail.com",
        "nadiyashamnade@gmail.com",
        "ananthukrishnanayilamanand@gmail.com",
        "shahanapookkath6@gmail.com",
      ];

      // Function to check if user is authorized ISTE member (optional client-side check)
      function isAuthorizedISTEMember(email, hasMembership, membershipId) {
        return (
          hasMembership === "yes" &&
          membershipId &&
          membershipId.trim() !== "" &&
          authorizedEmails.includes(email.toLowerCase().trim())
        );
      }

      // Function to generate ticket (client-side preview, but main ticket is emailed)
      function generateTicket(formData) {
        const ticketId = "ISTE-" + Date.now().toString().slice(-8);

        document.getElementById("ticketName").textContent =
          formData.get("name");
        document.getElementById("ticketEmail").textContent =
          formData.get("email");
        document.getElementById("ticketMembership").textContent =
          formData.get("membershipId");
        document.getElementById("ticketId").textContent = `ID: ${ticketId}`;

        document.getElementById("ticketContainer").style.display = "flex";
      }

      // Function to close ticket modal
      function closeTicket() {
        document.getElementById("ticketContainer").style.display = "none";
      }

      // Function to download ticket as image (optional client-side)
      function downloadTicket() {
        const ticket = document.getElementById("eventTicket");

        if (typeof html2canvas !== "undefined") {
          html2canvas(ticket, {
            backgroundColor: "transparent",
            scale: 2,
          }).then((canvas) => {
            const link = document.createElement("a");
            link.download = `ISTE_Event_Ticket_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
          });
        } else {
          const ticketData = `
EVENT TICKET - Public Speaking & Python Basics
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Participant: ${document.getElementById("ticketName").textContent}
Email: ${document.getElementById("ticketEmail").textContent}
ISTE Membership: ${document.getElementById("ticketMembership").textContent}
Event Date: 13th September 2025
Ticket ID: ${document.getElementById("ticketId").textContent}

Status: VERIFIED ISTE MEMBER
Access Level: FULL ACCESS

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
This ticket grants access to both events.
Please keep this ticket for verification at the event.
          `;

          const blob = new Blob([ticketData], { type: "text/plain" });
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.download = `ISTE_Event_Ticket_${Date.now()}.txt`;
          link.href = url;
          link.click();
          window.URL.revokeObjectURL(url);
        }
      }

      function showRegistration() {
        document.getElementById("mainPage").style.display = "none";
        document.getElementById("registrationPage").style.display = "block";
      }

      function showMainPage() {
        document.getElementById("mainPage").style.display = "flex";
        document.getElementById("registrationPage").style.display = "none";
        document.getElementById("ticketContainer").style.display = "none";
        document.getElementById("registrationForm").reset();
        document.getElementById("membershipIdField").style.display = "none";
        document.getElementById("paymentSection").style.display = "none";
        document.getElementById("successMessage").style.display = "none";
      }

      function toggleMembershipFields() {
        const membership = document.getElementById("isteMembership").value;
        const membershipIdField = document.getElementById("membershipIdField");
        const paymentSection = document.getElementById("paymentSection");
        const membershipIdInput = document.getElementById("membershipId");
        const paymentLinkInput = document.getElementById("paymentLink");

        if (membership === "yes") {
          membershipIdField.style.display = "block";
          paymentSection.style.display = "none";
          membershipIdInput.required = true;
          paymentLinkInput.required = false;
        } else if (membership === "no") {
          membershipIdField.style.display = "none";
          paymentSection.style.display = "block";
          membershipIdInput.required = false;
          paymentLinkInput.required = true;
        } else {
          membershipIdField.style.display = "none";
          paymentSection.style.display = "none";
          membershipIdInput.required = false;
          paymentLinkInput.required = false;
        }
      }

      // Form submission handler - Send to Apps Script
      document
        .getElementById("registrationForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const membership = formData.get("isteMembership");
          const paymentLink = formData.get("paymentLink");

          if (membership === "yes" && !formData.get("membershipId")) {
            alert("Please enter your ISTE Membership ID");
            return;
          }

          if (
            membership === "no" &&
            (!paymentLink || paymentLink.trim() === "")
          ) {
            alert(
              "Please provide a valid Google Drive link for your payment receipt"
            );
            return;
          }

          const submitBtn = document.querySelector(".submit-btn");
          const originalText = submitBtn.textContent;
          submitBtn.textContent = "Sending Registration...";
          submitBtn.disabled = true;

          try {
            const data = {
              name: formData.get("name"),
              email: formData.get("email"),
              phone: formData.get("phone"),
              isteMembership: membership,
              membershipId: formData.get("membershipId") || "",
              paymentLink: paymentLink || "",
            };

            console.log("Sending data:", data);
            const response = await fetch(APPS_SCRIPT_URL, {
              method: "POST",
              body: JSON.stringify(data),
              headers: {
                "Content-Type": "application/json",
              },
            });

            const responseText = await response.text();
            console.log("Raw response:", responseText);
            const result = JSON.parse(responseText);
            console.log("Parsed response:", result);

            if (response.ok && result.status === "Success") {
              document.getElementById("successMessage").style.display = "block";
              this.style.display = "none";
            } else {
              throw new Error(result.error || "Unknown server error");
            }
          } catch (error) {
            console.error("Registration failed:", error);
            alert(
              `Registration failed. Please try again. Details: ${error.message}`
            );
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
          }
        });

      setInterval(() => {
        const titles = document.querySelectorAll(".section-title");
        titles.forEach((title) => {
          if (Math.random() < 0.1) {
            title.style.textShadow = `
                    ${Math.random() * 10 - 5}px 0 #ff3366,
                    ${Math.random() * 10 - 5}px 0 #0066ff
                `;
            setTimeout(() => {
              title.style.textShadow = "0 0 20px rgba(255, 255, 255, 0.5)";
            }, 100);
          }
        });
      }, 2000);
    </script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
      defer
    ></script>
  </body>
</html>
